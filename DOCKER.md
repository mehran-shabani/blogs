# ?? ??????? Docker

??? ?????? ???? ??????? ?? Docker ???? ????? ????? ?? ??? ??????.

## ?? ??????????

- Docker
- Docker Compose

## ?? ?????????? ????

### 1. ????? Environment Variables

```bash
# ????? ???? .env ?? root ?????
cp .env.example .env
# ?????? ? ?????? API Keys
```

????? `.env`:
```env
OPENAI_API_KEY=sk-your-key-here
OPENAI_BASE_URL=https://api.gapgpt.app/v1
FIRECRAWL_API_KEY=fc-your-key-here
```

### 2. Build ? ????

```bash
# Build images
docker-compose build

# ????? ??? ????????
docker-compose up

# ?? ?? background
docker-compose up -d
```

## ?? ??????? ????

### ?????? ??????
```bash
# ??? ????????
docker-compose logs -f

# ??? backend
docker-compose logs -f backend

# ??? frontend
docker-compose logs -f frontend
```

### ????? ????
```bash
# ????? ????
docker-compose stop

# ??? containers
docker-compose down

# ??? ??? ??? (???? volumes)
docker-compose down -v
```

### Restart
```bash
# Restart ?? ?????
docker-compose restart backend

# Rebuild ? restart
docker-compose up -d --build backend
```

## ?? ????????

### Backend
- **Port:** 8000
- **URL:** http://localhost:8000
- **Docs:** http://localhost:8000/docs

### Frontend
- **Port:** 3000
- **URL:** http://localhost:3000

### Qdrant
- **Port:** 6333
- **Dashboard:** http://localhost:6333/dashboard

## ?? ?????

### ?????? ?? shell ?????

```bash
# Backend
docker-compose exec backend bash

# Frontend
docker-compose exec frontend sh
```

### ?????? logs ???

```bash
docker-compose logs --tail=100 backend
```

### ????? health

```bash
# Backend
curl http://localhost:8000/api/health

# Qdrant
curl http://localhost:6333/
```

## ??? Production Build

???? production? Dockerfile ?? ?????? ????:

### Frontend Dockerfile (Production)
```dockerfile
FROM node:18-alpine AS builder
WORKDIR /app
COPY package*.json ./
RUN npm ci
COPY . .
RUN npm run build

FROM node:18-alpine AS runner
WORKDIR /app
COPY --from=builder /app/.next ./.next
COPY --from=builder /app/public ./public
COPY --from=builder /app/package*.json ./
RUN npm ci --production
EXPOSE 3000
CMD ["npm", "start"]
```

### Build ???? Production
```bash
docker-compose -f docker-compose.prod.yml up -d
```

## ?? ?????

?? **???? ???:**

1. **????** API Keys ?? ?? Dockerfile ???? ?????
2. ?? `.env` ???? secrets ??????? ????
3. `.env` ?? ?? `.gitignore` ????? ????
4. ?? production ?? Docker secrets ??????? ????

## ?? Volumes

```bash
# ???? volumes
docker volume ls

# ??? volume ???
docker volume rm persian-search-engine_qdrant_storage

# Backup volume
docker run --rm -v persian-search-engine_qdrant_storage:/data -v $(pwd):/backup alpine tar czf /backup/qdrant_backup.tar.gz -C /data .

# Restore volume
docker run --rm -v persian-search-engine_qdrant_storage:/data -v $(pwd):/backup alpine tar xzf /backup/qdrant_backup.tar.gz -C /data
```

## ?? ???????????

```bash
# Pull latest code
git pull

# Rebuild images
docker-compose build --no-cache

# Restart services
docker-compose up -d
```

## ?? ??? ??????

### Port already in use
```bash
# ???? ???? process
lsof -i :8000
# ??
sudo netstat -tulpn | grep :8000

# ????? ????
docker-compose down
```

### Out of disk space
```bash
# ???????
docker system prune -a
docker volume prune
```

### Image build failed
```bash
# Clear cache
docker builder prune

# Rebuild
docker-compose build --no-cache
```

## ?? Monitoring (?????)

```yaml
# docker-compose.yml - ?????? monitoring
  prometheus:
    image: prom/prometheus
    ports:
      - "9090:9090"
      
  grafana:
    image: grafana/grafana
    ports:
      - "3001:3000"
```

## ?? ???????? ????

- [Docker Documentation](https://docs.docker.com/)
- [Docker Compose Documentation](https://docs.docker.com/compose/)
- [Best Practices](https://docs.docker.com/develop/dev-best-practices/)
